rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // Token usage collection (existing structure)
    match /tokenUsage/{codeId} {
      allow read: if true; // Allow reading for validation
      allow update: if true; // Allow updating token usage
      allow create, delete: if false; // Only admin can create/delete
    }
    
    // Referral codes collection - admin only
    match /referral-codes/{codeId} {
      allow read: if true; // Allow reading for validation
      allow write: if false; // Only admin can create/update via server
    }
    
    // Generated briefs collection - read/write with referral code
    match /generated-briefs/{briefId} {
      allow read: if true; // Allow reading for sharing
      allow create: if true; // Allow creating briefs
      allow update, delete: if false; // Only admin can modify
    }
    
    // Brief usage analytics - read only
    match /brief-usage/{usageId} {
      allow read: if true; // Allow reading for analytics
      allow create: if true; // Allow creating usage records
      allow update, delete: if false; // Only admin can modify
    }
    
    // Shared briefs collection - public read/write
    match /shared-briefs/{briefId} {
      allow read: if true; // Public read access
      allow create: if true; // Allow creating shared briefs
      allow update, delete: if false; // Only admin can modify
    }
    
    // Client analytics collection
    match /client-analytics/{analyticsId} {
      allow read: if true; // Allow reading analytics
      allow create: if true; // Allow creating analytics
      allow update, delete: if false; // Only admin can modify
    }
  }
}
